pipeline{
	agent any
	environment {
        container = "supersimpledockerwebsitetest"
        registry = "http://registry:5000/"
	}
	stages {
		stage('Build') {
            steps {
                sh "docker build -t $registry$container:latest ."
            }
		}
        stage('Deploy our image') { 
            steps { 
                sh '''
                    docker image tag $registry$container:latest $registry$container:latest
                    docker image push $registry$container:latest
                '''
            }
        }
	}

	post {
		always {
            sh "docker rmi $registry$container:latest"
		}
	}
}