pipeline{
	agent any
	environment {
        registry = "thunderkill/supersimpledockerwebsitetest"
	}
	stages {
		stage('Build') {
            steps {
                sh "docker build -t $registry:latest ."
            }
		}
        stage('Deploy our image') { 
            steps { 
                withDockerRegistry([ credentialsId: "docker-credentials", url: "" ]) {
                    sh  "docker push $registry:latest" 
                }
            }
        }
	}

	post {
		always {
            sh "docker rmi $registry:latest"
		}
	}
}